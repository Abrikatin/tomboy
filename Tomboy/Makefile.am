
SUBDIRS = . Plugins

CSC = mcs

TARGET = Tomboy.exe
WRAPPER = tomboy

if ENABLE_DBUS
DBUS_CSFLAGS = -define:ENABLE_DBUS
DBUS_CSFILES = 				\
	$(srcdir)/dbus-sharp/*.cs	\
	$(srcdir)/RemoteControl.cs	\
	$(srcdir)/RemoteControlProxy.cs
endif

if FIXED_GTKSPELL
FIXED_GTKSPELL_CSFLAGS = -define:FIXED_GTKSPELL
endif

CSFLAGS = 				\
	-debug				\
	-define:DEBUG 			\
	-unsafe 			\
	-target:exe 			\
	$(DBUS_CSFLAGS) 		\
	$(FIXED_GTKSPELL_CSFLAGS)

CSFILES = 					\
	$(srcdir)/Tomboy.cs 			\
	$(srcdir)/Applet.cs 			\
	$(srcdir)/Logger.cs			\
	$(srcdir)/Note.cs 			\
	$(srcdir)/NoteManager.cs 		\
	$(srcdir)/NoteWindow.cs 		\
	$(srcdir)/NoteBuffer.cs 		\
	$(srcdir)/NoteTag.cs 			\
	$(srcdir)/PluginManager.cs		\
	$(srcdir)/Preferences.cs		\
	$(srcdir)/RecentChanges.cs		\
	$(srcdir)/Search.cs 			\
	$(srcdir)/Tray.cs 			\
	$(srcdir)/Trie.cs			\
	$(srcdir)/Undo.cs 			\
	$(srcdir)/Utils.cs			\
	$(srcdir)/Watchers.cs			\
	$(srcdir)/XKeybinder.cs			\
	\
	$(srcdir)/panelapplet/*.cs		\
	\
	$(DBUS_CSFILES)	

ASSEMBLIES = 		\
	$(TOMBOY_LIBS) 	\
	-r:Mono.Posix

RESOURCES = 										\
	-resource:$(top_srcdir)/data/GNOME_TomboyApplet.xml,GNOME_TomboyApplet.xml	\
	-resource:$(top_builddir)/data/DefaultPlugins.desktop,DefaultPlugins.desktop	\
	-resource:$(top_srcdir)/data/images/tomboy.png,tomboy.png			\
	-resource:$(top_srcdir)/data/images/tintin.png,tintin.png			\
	-resource:$(top_srcdir)/data/images/gnome-searchtool.png,gnome-searchtool.png

$(TARGET): $(CSFILES) Defines.cs
	$(CSC) -out:$@ $(CSFLAGS) $^ $(ASSEMBLIES) $(RESOURCES)

tomboylibdir = $(pkglibdir)
tomboylib_DATA = $(TARGET) $(TARGET).config


bin_SCRIPTS = $(WRAPPER)

$(WRAPPER): $(srcdir)/$(WRAPPER).in Makefile
	sed -e "s|\@prefix\@|$(prefix)|g" 		\
	    -e "s|\@pkglibdir\@|$(pkglibdir)|g" 	\
	    -e "s|\@bindir\@|$(bindir)|g"		\
	    -e "s|\@target\@|$(TARGET)|g" 		\
	    -e "s|\@wrapper\@|$(WRAPPER)|g"		\
	    -e "s|\@extragac\@|$(EXTRA_GAC_PREFIX)|g"	\
	    < $< > $@
	chmod +x $(WRAPPER)

$(TARGET).config: $(srcdir)/$(TARGET).config.in Makefile
	sed -e "s|\@pkglibdir\@|$(pkglibdir)|" \
	    -e "s|\@DBUS_SOVERSION\@|$(DBUS_SOVERSION)|" \
	    < $< > $@

Defines.cs: $(srcdir)/Defines.cs.in Makefile
	sed -e "s|\@version\@|$(VERSION)|"     \
	    -e "s|\@datadir\@|$(datadir)|"     \
	    -e "s|\@pkglibdir\@|$(pkglibdir)|" \
	    < $< > $@


EXTRA_DIST =            		\
	$(CSFILES)      		\
	$(WRAPPER).in			\
	$(TARGET).config.in		\
	$(srcdir)/Defines.cs.in	

CLEANFILES =			\
	$(TARGET) 		\
	$(TARGET).config	\
	$(TARGET).mdb 		\
	$(WRAPPER)		\
	Defines.cs
